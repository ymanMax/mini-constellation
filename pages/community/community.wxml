<view class="container_community">
  <nav-custom title="æ˜Ÿåº§ç¤¾åŒº" bgColor="background-color: rgba(115, 90, 253, 1);" textColor="white"></nav-custom>

  <!-- å‘å¸ƒæ–°å¸–å­ -->
  <view class="publish_section">
    <view class="publish_input_container">
      <input
        class="publish_input"
        placeholder="åˆ†äº«ä½ çš„æ˜Ÿåº§æ•…äº‹..."
        value="{{newPostContent}}"
        bindinput="onPostInput"
        maxlength="200"
      />
      <button class="publish_btn" bindtap="publishPost" disabled="{{!newPostContent.trim()}}">å‘å¸ƒ</button>
    </view>
  </view>

  <!-- å¸–å­åˆ—è¡¨ -->
  <view class="posts_list">
    <view class="post_item" wx:for="{{posts}}" wx:key="id">
      <!-- å¸–å­å¤´éƒ¨ -->
      <view class="post_header">
        <image class="avatar" src="{{item.avatar}}" mode="aspectFill"></image>
        <view class="user_info">
          <view class="username">{{item.username}}</view>
          <view class="post_meta">
            <text class="constellation">{{item.æ˜Ÿåº§}}</text>
            <text class="create_time">{{item.createTime}}</text>
          </view>
        </view>
      </view>

      <!-- å¸–å­å†…å®¹ -->
      <view class="post_content">
        {{item.content}}
      </view>

      <!-- å¸–å­æ“ä½œ -->
      <view class="post_actions">
        <view class="action_item" bindtap="toggleLike" data-post-id="{{item.id}}">
          <text class="action_icon {{item.isLiked ? 'liked' : ''}}">â™¥</text>
          <text class="action_text">{{item.likes}}</text>
        </view>
        <view class="action_item" bindtap="showCommentInput" data-post-id="{{item.id}}">
          <text class="action_icon">ğŸ’¬</text>
          <text class="action_text">{{item.comments.length}}</text>
        </view>
        <view class="action_item" bindtap="sharePost" data-post-id="{{item.id}}">
          <text class="action_icon">ğŸ“¤</text>
          <text class="action_text">åˆ†äº«</text>
        </view>
      </view>

      <!-- è¯„è®ºåˆ—è¡¨ -->
      <view class="comments_list" wx:if="{{item.comments.length > 0}}">
        <view class="comment_item" wx:for="{{item.comments}}" wx:key="id" wx:for-item="comment">
          <image class="comment_avatar" src="{{comment.avatar || '../../assets/images/avatar-default.png'}}" mode="aspectFill"></image>
          <view class="comment_content">
            <view class="comment_header">
              <text class="comment_username">{{comment.username}}</text>
              <text class="comment_time">{{comment.createTime}}</text>
            </view>
            <view class="comment_text">{{comment.content}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯„è®ºè¾“å…¥æ¡† -->
  <view class="comment_input_overlay" wx:if="{{showCommentInput}}">
    <view class="comment_input_container">
      <input
        class="comment_input"
        placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."
        value="{{commentContent}}"
        bindinput="onCommentInput"
        maxlength="150"
      />
      <view class="comment_buttons">
        <button class="comment_cancel_btn" bindtap="cancelComment">å–æ¶ˆ</button>
        <button class="comment_send_btn" bindtap="publishComment" disabled="{{!commentContent.trim()}}">å‘é€</button>
      </view>
    </view>
  </view>
</view>
